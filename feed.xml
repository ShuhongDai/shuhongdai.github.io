<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.4">Jekyll</generator><link href="https://shuhongdai.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://shuhongdai.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2025-11-16T14:21:29+00:00</updated><id>https://shuhongdai.github.io/feed.xml</id><title type="html">blank</title><subtitle>A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. </subtitle><entry><title type="html">Running dm-control on a Headless Server: A Complete Debugging Log</title><link href="https://shuhongdai.github.io/blog/2025/An_Introductory_Look_at_Covariance_and_the_Mean_Vector/" rel="alternate" type="text/html" title="Running dm-control on a Headless Server: A Complete Debugging Log"/><published>2025-11-15T21:12:00+00:00</published><updated>2025-11-15T21:12:00+00:00</updated><id>https://shuhongdai.github.io/blog/2025/An_Introductory_Look_at_Covariance_and_the_Mean_Vector</id><content type="html" xml:base="https://shuhongdai.github.io/blog/2025/An_Introductory_Look_at_Covariance_and_the_Mean_Vector/"><![CDATA[<h2 id="introduction">Introduction</h2> <p>This post documents the process of configuring <strong>dm-control</strong> on a <strong>headless Ubuntu server</strong> for reinforcement learning experiments that require pixel-based observations. The goal was straightforward: load a task from the DeepMind Control Suite and render frames for a CNN-based policy. However, running dm-control without a graphical display consistently triggered a series of rendering failures.</p> <p>Rather than providing a tutorial, this article records the issues encountered, the different directions explored, and the final configuration that proved reliable. Hopefully, this log will help anyone attempting to run dm-control in a similar environment.</p> <hr/> <h2 id="initial-attempts-and-rendering-errors">Initial Attempts and Rendering Errors</h2> <p>The starting point was simply loading a task and calling <code class="language-plaintext highlighter-rouge">env.physics.render()</code>. On a local machine, this works immediately. On a headless server, the first result was an error referencing <strong>EGL</strong> and <strong>OpenGL</strong>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
AttributeError: 'NoneType' object has no attribute 'eglQueryString'

</code></pre></div></div> <p>Further attempts produced warnings about missing <code class="language-plaintext highlighter-rouge">DISPLAY</code> variables:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
X11: The DISPLAY environment variable is missing

</code></pre></div></div> <p>These messages made it clear that dm-control was attempting to initialize rendering through OpenGL/EGL, both of which require a graphics context the server did not provide. Disabling the <code class="language-plaintext highlighter-rouge">DISPLAY</code> variable or forcing EGL did not resolve the issue; the underlying environment simply lacked the dependencies required for hardware-accelerated rendering.</p> <hr/> <h2 id="investigating-the-role-of-pyopengl">Investigating the Role of PyOpenGL</h2> <p>The repeated mentions of EGL led to checking whether PyOpenGL played a role. Removing PyOpenGL temporarily modified the error messages, but it was automatically reinstalled when upgrading or reinstalling dm-control and Mujoco. This indicated that avoiding the OpenGL backend entirely was not feasible through uninstalling PyOpenGL alone.</p> <hr/> <h2 id="version-mismatch-between-dm-control-and-mujoco">Version Mismatch Between dm-control and Mujoco</h2> <p>At a later stage, entirely different errors appeared:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
eq_active not found
flex_xvert0 not found

</code></pre></div></div> <p>These errors are characteristic of <strong>Mujoco internal structure mismatches</strong>, suggesting that the installed versions of Mujoco and dm-control were not aligned. dm-control indexes Mujoco model structures by field name, and when they do not match, initialization fails even before rendering begins.</p> <p>This confirmed that two separate issues existed:</p> <ol> <li>Rendering backend not compatible with the server</li> <li>dm-control and Mujoco versions not compatible with each other</li> </ol> <p>Both needed to be addressed.</p> <hr/> <h2 id="moving-toward-a-software-rendering-approach">Moving Toward a Software Rendering Approach</h2> <p>Given that neither EGL nor OpenGL would work reliably on the server, the next candidate was <strong>OSMesa</strong>, a pure software renderer. OSMesa performs all rendering on the CPU and does not require a graphical display or GPU drivers. This makes it suitable for cloud or containerized environments.</p> <p>Ubuntu provides OSMesa through:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
libosmesa6-dev

</code></pre></div></div> <p>The key environment variable for Mujoco is:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
MUJOCO_GL=osmesa

</code></pre></div></div> <p>With this backend, Mujoco no longer attempts to initialize hardware-accelerated contexts.</p> <hr/> <h2 id="identifying-a-stable-mujoco--dm-control-combination">Identifying a Stable Mujoco + dm-control Combination</h2> <p>After testing multiple combinations, the following versions proved to be both compatible with each other and functional under OSMesa:</p> <ul> <li><strong>mujoco 2.3.3</strong></li> <li><strong>dm-control 1.0.11</strong></li> <li>Python 3.9</li> </ul> <p>This combination avoids the structure-indexing errors seen in newer pairings and also avoids invoking backends requiring OpenGL or EGL by default.</p> <hr/> <h2 id="verifying-the-configuration">Verifying the Configuration</h2> <p>With OSMesa enabled and the compatible versions installed, the following minimal script successfully produced a rendered frame:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sh">"</span><span class="s">MUJOCO_GL</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">osmesa</span><span class="sh">"</span>
<span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sh">"</span><span class="s">DISPLAY</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="sh">""</span>

<span class="kn">from</span> <span class="n">dm_control</span> <span class="kn">import</span> <span class="n">suite</span>
<span class="kn">import</span> <span class="n">imageio</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">suite</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">cartpole</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">swingup</span><span class="sh">"</span><span class="p">)</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">env</span><span class="p">.</span><span class="n">physics</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">camera_id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Frame shape:</span><span class="sh">"</span><span class="p">,</span> <span class="n">frame</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">imageio</span><span class="p">.</span><span class="nf">imwrite</span><span class="p">(</span><span class="sh">"</span><span class="s">soft_render.png</span><span class="sh">"</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>
</code></pre></div></div> <p>The output confirmed that rendering worked:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Frame shape: (128, 128, 3)
Saved soft_render.png
</code></pre></div></div> <p>A few non-critical messages appear during interpreter shutdown, related to thread cleanup inside dm-controlâ€™s internal executor. These do not affect functionality.</p> <hr/> <h2 id="final-working-setup">Final Working Setup</h2> <p>Summarizing the configuration that worked consistently:</p> <ul> <li><strong>Python</strong>: 3.9</li> <li><strong>Mujoco</strong>: 2.3.3</li> <li><strong>dm-control</strong>: 1.0.11</li> <li><strong>System package</strong>: <code class="language-plaintext highlighter-rouge">libosmesa6-dev</code></li> <li><strong>Rendering backend</strong>: <code class="language-plaintext highlighter-rouge">MUJOCO_GL=osmesa</code></li> </ul> <p>This setup uses CPU-based software rendering, avoids any dependency on GPU drivers or graphical displays, and is compatible with reinforcement-learning algorithms requiring pixel observations.</p> <hr/> <h2 id="conclusion">Conclusion</h2> <p>Running dm-control on a headless server involves more than installing the library. Rendering backends, environment variables, and version compatibility all play important roles in determining whether Mujoco initializes correctly. After exploring several unsuccessful paths, the combination of <strong>OSMesa rendering</strong> and a <strong>compatible pair of dm-control and Mujoco versions</strong> proved to be a reliable solution.</p> <p>By documenting this process, this post aims to provide a clear reference for others setting up dm-control in a similar environment.</p>]]></content><author><name></name></author><category term="Reinforcement Learning"/><category term="Mujoco"/><category term="dm-control"/><category term="Rendering"/><summary type="html"><![CDATA[A practical record of configuring dm-control with Mujoco on a headless Ubuntu server, covering rendering failures, version mismatches, and the final workable setup.]]></summary></entry></feed>